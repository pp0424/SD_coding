<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发票详细信息</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 保留原有样式 */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #e3f2fd, #f5f9ff); min-height: 100vh; padding: 20px; color: #2c3e50; }
        .container { max-width: 1000px; margin: 0 auto; }
        .header-buttons { display: flex; gap: 15px; margin-bottom: 40px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; font-size: 16px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08); }
        .btn-back { background: #3498db; color: white; }
        .btn-home { background: #2980b9; color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08); }
        .btn:active { transform: translateY(1px); }
        .card { background: white; border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); padding: 40px; margin-bottom: 30px; animation: fadeIn 0.8s ease-out; }
        .card-title { text-align: center; margin-bottom: 30px; color: #2c3e50; font-size: 28px; position: relative; }
        .card-title:after { content: ''; display: block; width: 100px; height: 4px; background: linear-gradient(to right, #3498db, #2980b9); margin: 10px auto 0; border-radius: 2px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
        .info-item { display: flex; flex-direction: column; }
        .info-label { font-size: 14px; color: #7f8c8d; margin-bottom: 8px; font-weight: 500; }
        .info-value, .info-input { font-size: 18px; padding: 14px 16px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; color: #2c3e50; font-weight: 600; transition: all 0.3s; }
        .info-value:hover, .info-input:hover { background: #edf7ff; border-color: #3498db; }
        .info-input { font-weight: normal; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #e9ecef; padding: 12px; text-align: center; }
        th { background-color: #f5f9ff; }
        .save-container { position: fixed; right: 40px; bottom: 40px; z-index: 100; }
        .btn-save { background: linear-gradient(to right, #3498db, #2980b9); color: white; padding: 16px 45px; font-size: 18px; border-radius: 12px; box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3); display: flex; align-items: center; gap: 12px; transition: all 0.3s; }
        .btn-save:hover { transform: translateY(-3px) scale(1.03); box-shadow: 0 15px 30px rgba(52, 152, 219, 0.4); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .watermark { position: fixed; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.03; z-index: -1; background-image: radial-gradient(#3498db 1px, transparent 1px), radial-gradient(#2980b9 1px, transparent 1px); background-size: 40px 40px; background-position: 0 0, 20px 20px; }
    </style>
</head>
<body>
<div class="watermark"></div>
<div class="container">
    <!-- 顶部按钮 -->
    <div class="header-buttons">
        <button class="btn btn-back" onclick="window.history.back()"><i class="fas fa-arrow-left"></i> 返回上一页</button>
        <a class="btn btn-home" href="{{ url_for('finance.finance_home') }}">
    <i class="fas fa-home"></i> 返回财务主页
</a>

    </div>

    <!-- 发票信息表单 -->
    <form method="POST" action="{{ url_for('finance.save_invoice', order_id=sales_order.sales_order_id, delivery_id=delivery_note.delivery_note_id) }}">
        <div class="card">
            <h1 class="card-title">发票详细信息</h1>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">销售订单号</span>
                    <div class="info-value">{{ sales_order.sales_order_id }}</div>
                    <input type="hidden" name="order_id" value="{{ sales_order.sales_order_id }}">
                </div>
                <div class="info-item">
                    <span class="info-label">发货单号</span>
                    <div class="info-value">{{ delivery_note.delivery_note_id }}</div>
                    <input type="hidden" name="delivery_id" value="{{ delivery_note.delivery_note_id }}">
                </div>
                <div class="info-item">
                    <span class="info-label">发票总金额（含税）</span>
                    <div class="info-value">{{ "%.2f"|format(total_amount) }}</div>
                </div>
                <div class="info-item">
                    <span class="info-label">开票日期</span>
                    <input type="date" class="info-input" name="invoice_date" value="{{ today_str }}">
                </div>
                <div class="info-item">
                    <span class="info-label">付款期限</span>
                    <input type="date" class="info-input" name="payment_deadline" value="{{ payment_deadline_str }}">
                </div>
                <div class="info-item">
                    <span class="info-label">备注</span>
                    <input type="text" class="info-input" name="remarks" placeholder="可填写备注信息">
                </div>
            </div>

            <!-- 发票明细表 -->
            <table>
                <thead>
                    <tr>
                        <th>物料编号</th>
                        <th>数量</th>
                        <th>单位</th>
                        <th>单价</th>
                        <th>不含税金额</th>
                        <th>税额</th>
                        <th>含税金额</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in invoice_items %}
                    <tr>
                        <td>{{ item.material_id }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ item.unit }}</td>
                        <td>{{ "%.2f"|format(item.unit_price) }}</td>
                        <td>{{ "%.2f"|format(item.item_amount) }}</td>
                        <td>{{ "%.2f"|format(item.tax_amount) }}</td>
                        <td>{{ "%.2f"|format(item.total_amount) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- 保存按钮 -->
        <div class="save-container">
            <button type="submit" class="btn btn-save"><i class="fas fa-save"></i> 保存信息</button>
        </div>
    </form>
</div>
</body>
</html>
