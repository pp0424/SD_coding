<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>创建发票</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    /* 样式保持原样（省略，使用你原始代码） */
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>创建发票</h1>
  </header>

  <section class="search-section">
    <h2 class="search-title"><i class="fas fa-search"></i> 搜索订单信息</h2>
    <form id="search-form" class="search-form">
      <div class="form-group">
        <label for="order-number">订单号</label>
        <input type="text" id="order-number" placeholder="请输入订单号" required />
      </div>

      <div class="form-group">
        <label for="delivery-numbers">发货单号</label>
        <textarea id="delivery-numbers" placeholder="请输入发货单号，多个单号请用逗号分隔"></textarea>
        <span class="note">可输入多个发货单号，用逗号分隔</span>
      </div>

      <button type="submit" id="search-btn"><i class="fas fa-search"></i> 搜索</button>
    </form>
  </section>

  <section class="results-section">
    <h2 class="results-title"><i class="fas fa-list"></i> 搜索结果</h2>
    <table id="results-table">
      <thead>
      <tr>
        <th>订单号</th>
        <th>发货单号</th>
        <th>操作</th>
      </tr>
      </thead>
      <tbody id="results-body">
        <!-- 搜索结果将在这里插入 -->
      </tbody>
    </table>
  </section>

  <footer>
    <p>2025 ERP财务管理系统</p>
  </footer>
</div>

<script>
  document.getElementById('search-form').addEventListener('submit', function (e) {
    e.preventDefault();

    const orderNumber = document.getElementById('order-number').value.trim();
    const deliveryNumbers = document.getElementById('delivery-numbers').value.trim();

    if (!orderNumber && !deliveryNumbers) {
      alert('请输入订单号或发货单号！');
      return;
    }

    fetch(`/finance/api/search-delivery?order=${encodeURIComponent(orderNumber)}&delivery=${encodeURIComponent(deliveryNumbers)}`)
      .then(response => response.json())
      .then(data => {
        const tbody = document.getElementById('results-body');
        tbody.innerHTML = '';

        if (data.results.length === 0) {
          tbody.innerHTML = '<tr><td colspan="3">未找到相关记录</td></tr>';
          return;
        }

        data.results.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.order_id}</td>
            <td>${item.delivery_id}</td>
            <td>
              <button class="detail-btn" onclick="goToDetail('${item.order_id}', '${item.delivery_id}')">查看详情</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      })
      .catch(error => {
        console.error('查询出错:', error);
        alert('查询失败，请稍后重试。');
      });
  });

  function goToDetail(orderId, deliveryId) {
    const url = `/finance/create-invoice?order=${encodeURIComponent(orderId)}&delivery=${encodeURIComponent(deliveryId)}`;
    window.location.href = url;
  }
</script>
</body>
</html>
