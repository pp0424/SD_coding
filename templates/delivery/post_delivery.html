{% extends 'delivery/base.html' %}
{% block title %}发货过账{% endblock %}

{% block head_extra %}
<style>
  h3.page-title {
    font-weight: 700;
    color: #0d6efd;
  }

  .info-line {
    font-size: 0.95rem;
    color: #6c757d;
    margin-bottom: 1rem;
  }

  .form-card {
    border-radius: 14px;
    background: linear-gradient(135deg, #fff, #f4f8fc);
    box-shadow: 0 6px 16px rgba(0,0,0,0.05);
  }

  .form-control {
    font-size: 0.85rem;
  }

  .table-sm thead th {
    background-color: #eff4ff;
    font-weight: 600;
    font-size: 0.85rem;
  }

  .table-sm td {
    font-size: 0.85rem;
    vertical-align: middle;
  }

  .table-sm tbody tr:hover {
    background-color: #f9fcff;
    transition: background-color 0.2s ease;
  }

  .btn-success {
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(25,135,84,0.2);
  }

  .btn-outline-secondary {
    border-radius: 8px;
  }

  hr {
    border-top: 1px solid #dee2e6;
  }
</style>
{% endblock %}

{% block content %}
<div class="form-title-container">
    <h1 class="form-title">
      📤 发货过账 {{ delivery.delivery_note_id }}
    </h1>
  </div>

<p class="info-line">
  订单：<strong>{{ delivery.sales_order_id }}</strong> | 仓库：<strong>{{ delivery.warehouse_code }}</strong>
</p>

<form method="post" class="card p-4 shadow-sm form-card">
  {{ form.csrf_token }}
  <div class="row g-4 mb-3">
    <div class="col-md-4">
      {{ form.actual_delivery_date.label }}
      {{ form.actual_delivery_date(class="form-control", type="date") }}
    </div>
    <div class="col-md-8">
      {{ form.remarks.label }}
      {{ form.remarks(class="form-control") }}
    </div>
  </div>

  <hr>
  <h6 class="fw-bold text-secondary mb-3">📦 发货行项</h6>
  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead>
        <tr>
          <th>#</th>
          <th>物料</th>
          <th>计划数量</th>
          <th>实际发货</th>
        </tr>
      </thead>
      <tbody>
    {% for sub in form.items %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>
        <input type="text"
              class="form-control form-control-sm"
              value="{{ sub.material_id.data }}"
              readonly>
      </td>
      <td>
        <input type="number"
              step="0.001"
              class="form-control form-control-sm"
              value="{{ sub.planned_quantity.data }}"
              readonly>
      </td>
      <td>
        {{ sub.actual_quantity(class="form-control form-control-sm", step="0.001", min="0") }}
      </td>
    </tr>
    {% endfor %}

      </tbody>
    </table>
  </div>

  <div class="mt-4">
    <button class="btn btn-success me-2">
      <i class="bi bi-check-circle"></i> {{ form.submit.label.text }}
    </button>
    <a href="{{ url_for('delivery.delivery_detail', delivery_id=delivery.delivery_note_id) }}" class="btn btn-outline-secondary">
      <i class="bi bi-x-circle"></i> 取消
    </a>
  </div>
</form>
{% endblock %}
