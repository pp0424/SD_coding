{% extends 'delivery/base.html' %}
{% block title %}ç‰©æ–™åº“å­˜æŸ¥è¯¢{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='delivery/delivery_styles.css') }}">

<style>
  /* é¡µé¢æœ€å¤§å®½åº¦ä¸å±…ä¸­ */
  .page-container { max-width: 1180px; margin: 0 auto; padding: 16px; }
  /* å¡ç‰‡æ ·å¼ */
  .delivery-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); overflow: hidden; }
  /* å·¥å…·æ ä¸æ ‡é¢˜ */
  .card-header { padding: 16px 18px 8px; background: linear-gradient(180deg, #fafbfc 0%, #ffffff 100%); border-bottom: 1px solid #e5e7eb; }
  .toolbar { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
  .stats-info { font-size: 0.9rem; color: #6b7280; }
  /* æŸ¥è¯¢è¡¨å• */
  .query-form { padding: 12px 18px 8px; }
  .query-form .form-label { font-weight: 600; color: #374151; }
  .btn-search { background: #2563eb; border-color: #2563eb; color: white; }
  .btn-search:hover { background: #1e40af; border-color: #1e40af; color: white; }
  .btn-reset { background: #f3f4f6; border-color: #e5e7eb; }
  /* è¡¨æ ¼æ ·å¼ */
  .table-section { padding: 12px 18px 18px; }
  .table-responsive { max-height: 62vh; border: 1px solid #e5e7eb; border-radius: 8px; overflow: auto; }
  .delivery-table { width: 100%; border-collapse: separate; border-spacing: 0; }
  .delivery-table thead th { position: sticky; top: 0; background: #f8fafc; font-weight: 700; color: #374151; padding: 10px 12px; border-bottom: 1px solid #e5e7eb; }
  .delivery-table tbody td { padding: 10px 12px; border-bottom: 1px solid #f1f5f9; color: #1f2937; vertical-align: middle; }
  .delivery-table tbody tr:hover { background: #f9fafb; }
  /* ç©ºçŠ¶æ€ */
  .empty-state { text-align: center; color: #6b7280; }
  .empty-state .inner { display: flex; height: 200px; align-items: center; justify-content: center; flex-direction: column; gap: 6px; }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
  <div class="form-title-container">
    <h1 class="form-title">ğŸ”¢ ç‰©æ–™åº“å­˜</h1>
  </div>

  <div class="delivery-card animate-fade">
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="card-header">
      <div class="toolbar">
        <div>
          <i class="bi bi-box-seam me-2"></i>
          <strong>ç‰©æ–™ä¿¡æ¯åˆ—è¡¨</strong>
          <span class="stats-info ms-3">
            å…±æ‰¾åˆ° {{ pagination.total if pagination is defined and pagination else inventories|length }} æ¡è®°å½•
          </span>
        </div>
        <div class="d-flex gap-2">
          <button type="button" class="btn btn-outline-secondary btn-sm" onclick="window.print()">
            <i class="bi bi-printer me-1"></i> æ‰“å°
          </button>
        </div>
      </div>

      <!-- æŸ¥è¯¢è¡¨å• -->
      <form method="get" class="row g-3 query-form align-items-end">
        {{ form.csrf_token }}
        <div class="col-md-3">
          <label class="form-label" for="material_id">{{ form.material_id.label.text }}</label>
          {{ form.material_id(class="form-control", id="material_id", placeholder="æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢") }}
        </div>
        <div class="col-md-4">
          <label class="form-label" for="description">{{ form.description.label.text }}</label>
          {{ form.description(class="form-control", id="description", placeholder="ç‰©æ–™æè¿°å…³é”®è¯") }}
        </div>
        <div class="col-md-3">
          <label class="form-label" for="storage_location">{{ form.storage_location.label.text }}</label>
          {{ form.storage_location(class="form-control", id="storage_location", placeholder="ä»“åº“/åº“ä½") }}
        </div>
        <div class="col-md-2 d-flex gap-2">
          {{ form.submit(class="btn btn-search w-100") }}
          <a class="btn btn-reset w-100" href="{{ url_for('delivery.inventory_detail') }}">é‡ç½®</a>
        </div>
      </form>
    </div>

    <!-- è¡¨æ ¼åŒºåŸŸ -->
    <div class="table-section">
      <div class="table-responsive">
        <table class="delivery-table table-hover">
          <thead>
            <tr>
              <th>ç‰©æ–™ç¼–å·</th>
              <th>ç‰©æ–™æè¿°</th>
              <th>åŸºæœ¬è®¡é‡å•ä½</th>
              <th>å­˜å‚¨ä½ç½®</th>
              <th>è´¦é¢æ€»åº“å­˜</th>
              <th>å¯ç”¨åº“å­˜</th>
              <th>å·²åˆ†é…åº“å­˜</th>
              <th>å¾…å‡ºåº“é‡</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in inventories %}
            <tr>
              <td class="fw-bold text-primary">{{ inv.material_id }}</td>
              <td>{{ inv.description }}</td>
              <td><span class="badge bg-light text-dark">{{ inv.base_unit }}</span></td>
              <td><span class="badge bg-light text-dark">{{ inv.storage_location }}</span></td>
              <td>{{ inv.physical_stock }}</td>
              <td>{{ inv.available_stock }}</td>
              <td>{{ inv.allocated_stock }}</td>
              <td>{{ inv.pending_outbound }}</td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="empty-state">
                <div class="inner">
                  <i class="bi bi-inbox display-4 d-block mb-2"></i>
                  <h5>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ç‰©æ–™è®°å½•</h5>
                  <p class="text-muted">è¯·è°ƒæ•´æŸ¥è¯¢æ¡ä»¶åé‡è¯•</p>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- åˆ†é¡µ -->
      {% if pagination is defined and pagination and pagination.pages > 1 %}
      <div class="d-flex justify-content-between align-items-center mt-3">
        <div class="text-muted">
          ç¬¬ {{ pagination.page }} / {{ pagination.pages }} é¡µï¼Œåˆè®¡ {{ pagination.total }} æ¡
        </div>
        <div class="d-flex gap-2">
          {% if pagination.has_prev %}
            <a class="btn btn-outline-secondary btn-sm"
               href="{{ url_for('delivery.inventory_detail') }}?page={{ pagination.prev_num }}&material_id={{ form.material_id.data }}&description={{ form.description.data }}&storage_location={{ form.storage_location.data }}">
              ä¸Šä¸€é¡µ
            </a>
          {% else %}
            <button class="btn btn-outline-secondary btn-sm" disabled>ä¸Šä¸€é¡µ</button>
          {% endif %}

          {% if pagination.has_next %}
            <a class="btn btn-outline-secondary btn-sm"
               href="{{ url_for('delivery.inventory_detail') }}?page={{ pagination.next_num }}&material_id={{ form.material_id.data }}&description={{ form.description.data }}&storage_location={{ form.storage_location.data }}">
              ä¸‹ä¸€é¡µ
            </a>
          {% else %}
            <button class="btn btn-outline-secondary btn-sm" disabled>ä¸‹ä¸€é¡µ</button>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
