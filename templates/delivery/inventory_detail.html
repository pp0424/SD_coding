{# 
  æ¨¡æ¿åç§°ï¼šç‰©æ–™åº“å­˜æŸ¥è¯¢
  ç”¨é€”ï¼šç”¨äºå±•ç¤ºå’ŒæŸ¥è¯¢ç‰©æ–™åº“å­˜ï¼ŒåŒ…å«æŸ¥è¯¢è¡¨å•ã€ç»“æœè¡¨æ ¼ã€åˆ†é¡µä¸æ‰“å°åŠŸèƒ½
  ç»§æ‰¿ï¼šä¾èµ– delivery/base.html æä¾›çš„åŸºç¡€å¸ƒå±€ï¼ˆheadã€bodyã€æ ·å¼ä¸è„šæ‰‹æ¶ï¼‰
#}
{% extends 'delivery/base.html' %}

{% block title %}ç‰©æ–™åº“å­˜æŸ¥è¯¢{% endblock %}

{% block head_extra %}
{# å…¬å…±æ ·å¼æ–‡ä»¶ï¼ˆå…¨å±€/æ¨¡å—çº§é€šç”¨æ ·å¼ï¼‰ #}
<link rel="stylesheet" href="{{ url_for('static', filename='delivery/delivery_styles.css') }}">

<style>
  /* ===== é¡µé¢å¸ƒå±€ä¸å®¹å™¨ ===== */
  /* è®¾ç½®é¡µé¢å†…å®¹æœ€å¤§å®½åº¦å¹¶å±…ä¸­ï¼Œå†…è¾¹è·ç”¨äºæä¾›å‘¼å¸ç©ºé—´ */
  .page-container { 
    max-width: 1180px; 
    margin: 0 auto; 
    padding: 16px; 
  }

  /* ===== å¡ç‰‡æ ·å¼ ===== */
  /* ç»Ÿä¸€å†…å®¹æ‰¿è½½å®¹å™¨ï¼šå¡ç‰‡æ ·å¼ã€åœ†è§’ä¸æµ…é˜´å½± */
  .delivery-card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.04);
    overflow: hidden; /* é˜²æ­¢åœ†è§’åŒºåŸŸæº¢å‡º */
  }

  /* ===== é¡¶éƒ¨å·¥å…·æ ä¸æ ‡é¢˜åŒºåŸŸ ===== */
  .card-header {
    padding: 16px 18px 8px;
    background: linear-gradient(180deg, #fafbfc 0%, #ffffff 100%);
    border-bottom: 1px solid #e5e7eb;
  }
  .toolbar {
    display: flex; 
    align-items: center; 
    justify-content: space-between;
    flex-wrap: wrap; 
    gap: 10px; /* çª„å±æ—¶å…ƒç´ æ¢è¡Œçš„é—´è· */
  }
  .stats-info { 
    font-size: 0.9rem; 
    color: #6b7280; 
  }

  /* ===== æŸ¥è¯¢è¡¨å•æ ·å¼ ===== */
  .query-form { 
    padding: 12px 18px 8px; 
  }
  .query-form .form-label { 
    font-weight: 600; 
    color: #374151; 
  }
  /* ç»Ÿä¸€ä¸»æŒ‰é’®ï¼ˆæŸ¥è¯¢ï¼‰æ ·å¼ï¼šå“ç‰Œè‰²ä¸æ‚¬åœåé¦ˆ */
  .btn-search { 
    background: #2563eb; 
    border-color: #2563eb; 
    color: white; 
  }
  .btn-search:hover { 
    background: #1e40af; 
    border-color: #1e40af; 
    color: white; 
  }
  /* æ¬¡çº§æŒ‰é’®ï¼ˆé‡ç½®ï¼‰æ ·å¼ï¼šæµ…ç°èƒŒæ™¯ */
  .btn-reset { 
    background: #f3f4f6; 
    border-color: #e5e7eb; 
  }

  /* ===== è¡¨æ ¼åŒºåŸŸæ ·å¼ ===== */
  .table-section { 
    padding: 12px 18px 18px; 
  }
  .table-responsive {
    /* é™é«˜ + æ»šåŠ¨ï¼Œé…åˆ sticky è¡¨å¤´æå‡å¯è¯»æ€§ */
    max-height: 62vh;
    border: 1px solid #e5e7eb; 
    border-radius: 8px; 
    overflow: auto;
  }
  .delivery-table { 
    width: 100%; 
    border-collapse: separate; 
    border-spacing: 0; 
  }
  .delivery-table thead th {
    position: sticky; 
    top: 0;              /* å¯ç”¨è¡¨å¤´å¸é¡¶ */
    background: #f8fafc; 
    font-weight: 700; 
    color: #374151;
    padding: 10px 12px; 
    border-bottom: 1px solid #e5e7eb;
    z-index: 1;          /* é˜²æ­¢è¢«å†…å®¹è¦†ç›– */
  }
  .delivery-table tbody td {
    padding: 10px 12px; 
    border-bottom: 1px solid #f1f5f9;
    color: #1f2937; 
    vertical-align: middle; /* å¤šè¡Œæ–‡æœ¬æ—¶ä¿æŒå‚ç›´å±…ä¸­ */
  }
  .delivery-table tbody tr:hover { 
    background: #f9fafb; 
  }

  /* ===== ç©ºçŠ¶æ€ ===== */
  .empty-state { 
    text-align: center; 
    color: #6b7280; 
  }
  .empty-state .inner {
    display: flex; 
    height: 200px; 
    align-items: center;
    justify-content: center; 
    flex-direction: column; 
    gap: 6px;
  }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
  {# é¡µé¢ä¸»æ ‡é¢˜ï¼šä¸ä¸šåŠ¡æ¨¡å—å¯¹åº” #}
  <div class="form-title-container">
    <h1 class="form-title">ğŸ”¢ ç‰©æ–™åº“å­˜</h1>
  </div>

  <div class="delivery-card animate-fade">
    {# ================= é¡¶éƒ¨ï¼šå·¥å…·æ  + æŸ¥è¯¢è¡¨å• ================= #}
    <div class="card-header">
      <div class="toolbar">
        <div>
          <i class="bi bi-box-seam me-2"></i>
          <strong>ç‰©æ–™ä¿¡æ¯åˆ—è¡¨</strong>
          {# ç»Ÿè®¡ä¿¡æ¯ï¼šä¼˜å…ˆæ˜¾ç¤ºåˆ†é¡µæ€»æ•°ï¼›æ— åˆ†é¡µæ—¶æ˜¾ç¤ºå½“å‰åˆ—è¡¨é•¿åº¦ #}
          <span class="stats-info ms-3">
            å…±æ‰¾åˆ° {{ pagination.total if pagination is defined and pagination else inventories|length }} æ¡è®°å½•
          </span>
        </div>
        <div class="d-flex gap-2">
          {# æ‰“å°ï¼šè°ƒç”¨æµè§ˆå™¨æ‰“å°å½“å‰é¡µé¢ #}
          <button type="button" class="btn btn-outline-secondary btn-sm" onclick="window.print()">
            <i class="bi bi-printer me-1"></i> æ‰“å°
          </button>
        </div>
      </div>

      {# æŸ¥è¯¢è¡¨å•ï¼šGET æäº¤ä»¥æ”¯æŒåˆ†äº«/å›æ˜¾ï¼›å­—æ®µä¸ºæ¨¡ç³ŠåŒ¹é… #}
      <form method="get" class="row g-3 query-form align-items-end">
        {{ form.csrf_token }} {# å³ä¾¿ GET ä¹Ÿä¿ç•™ CSRFï¼Œä¾¿äºç»Ÿä¸€æ¨¡æ¿ #}

        {# ç‰©æ–™ç¼–å·ï¼ˆæ”¯æŒæ¨¡ç³Šï¼‰ #}
        <div class="col-md-3">
          <label class="form-label" for="material_id">{{ form.material_id.label.text }}</label>
          {{ form.material_id(class="form-control", id="material_id", placeholder="æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢") }}
        </div>

        {# ç‰©æ–™æè¿°å…³é”®è¯ #}
        <div class="col-md-4">
          <label class="form-label" for="description">{{ form.description.label.text }}</label>
          {{ form.description(class="form-control", id="description", placeholder="ç‰©æ–™æè¿°å…³é”®è¯") }}
        </div>

        {# ä»“åº“/åº“ä½ç­›é€‰ #}
        <div class="col-md-3">
          <label class="form-label" for="storage_location">{{ form.storage_location.label.text }}</label>
          {{ form.storage_location(class="form-control", id="storage_location", placeholder="ä»“åº“/åº“ä½") }}
        </div>

        {# æŸ¥è¯¢ä¸é‡ç½® #}
        <div class="col-md-2 d-flex gap-2">
          {{ form.submit(class="btn btn-search w-100") }}
          {# é‡ç½®ï¼šè·³è½¬è‡³æ— æŸ¥è¯¢å‚æ•°çš„è¯¦æƒ…é¡µï¼Œæ¸…ç©ºç­›é€‰æ¡ä»¶ #}
          <a class="btn btn-reset w-100" href="{{ url_for('delivery.inventory_detail') }}">é‡ç½®</a>
        </div>
      </form>
    </div>

    {# ================= è¡¨æ ¼ï¼šåº“å­˜æ•°æ®å±•ç¤º ================= #}
    <div class="table-section">
      <div class="table-responsive">
        <table class="delivery-table table-hover">
          <thead>
            <tr>
              {# åˆ—å«ä¹‰ï¼šä¸»é”®/æè¿°/è®¡é‡/åº“ä½/åº“å­˜å››è±¡é™ #}
              <th>ç‰©æ–™ç¼–å·</th>
              <th>ç‰©æ–™æè¿°</th>
              <th>åŸºæœ¬è®¡é‡å•ä½</th>
              <th>å­˜å‚¨ä½ç½®</th>
              <th>è´¦é¢æ€»åº“å­˜</th>
              <th>å¯ç”¨åº“å­˜</th>
              <th>å·²åˆ†é…åº“å­˜</th>
              <th>å¾…å‡ºåº“é‡</th>
            </tr>
          </thead>
          <tbody>
            {# å¾ªç¯æ¸²æŸ“åº“å­˜æ•°æ®ï¼›æ— æ•°æ®åˆ™èµ° else åˆ†æ”¯å±•ç¤ºç©ºçŠ¶æ€ #}
            {% for inv in inventories %}
            <tr>
              {# ä¸»é”®/ç¼–å·ï¼šç”¨å¼ºè°ƒæ ·å¼æå‡å¯è¾¨è¯†åº¦ #}
              <td class="fw-bold text-primary">{{ inv.material_id }}</td>

              {# ç‰©æ–™æè¿° #}
              <td>{{ inv.description }}</td>

              {# åŸºæœ¬è®¡é‡å•ä½ä¸åº“ä½ï¼šç”¨ badge å¼±å¼ºè°ƒ #}
              <td><span class="badge bg-light text-dark">{{ inv.base_unit }}</span></td>
              <td><span class="badge bg-light text-dark">{{ inv.storage_location }}</span></td>

              {# åº“å­˜å››è±¡é™ï¼šæ•°å€¼ç²¾åº¦å·²åœ¨æ¨¡å‹å±‚å¤„ç†ï¼Œæ— éœ€å†æ ¼å¼åŒ– #}
              <td>{{ inv.physical_stock }}</td>
              <td>{{ inv.available_stock }}</td>
              <td>{{ inv.allocated_stock }}</td>
              <td>{{ inv.pending_outbound }}</td>
            </tr>
            {% else %}
            {# ç©ºæ•°æ®å ä½ï¼šç»™å‡ºå‹å¥½æç¤ºä¸å¼•å¯¼ #}
            <tr>
              <td colspan="8" class="empty-state">
                <div class="inner">
                  <i class="bi bi-inbox display-4 d-block mb-2"></i>
                  <h5>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ç‰©æ–™è®°å½•</h5>
                  <p class="text-muted">è¯·è°ƒæ•´æŸ¥è¯¢æ¡ä»¶åé‡è¯•</p>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {# ================= åˆ†é¡µï¼šä»…åœ¨å­˜åœ¨åˆ†é¡µå¯¹è±¡ä¸”æ€»é¡µæ•°å¤§äº 1 æ—¶æ˜¾ç¤º ================= #}
      {% if pagination is defined and pagination and pagination.pages > 1 %}
      <div class="d-flex justify-content-between align-items-center mt-3">
        {# å·¦ä¾§ï¼šå½“å‰é¡µä¿¡æ¯ #}
        <div class="text-muted">
          ç¬¬ {{ pagination.page }} / {{ pagination.pages }} é¡µï¼Œåˆè®¡ {{ pagination.total }} æ¡
        </div>

        {# å³ä¾§ï¼šä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µï¼Œä¿ç•™å½“å‰æŸ¥è¯¢æ¡ä»¶ #}
        <div class="d-flex gap-2">
          {% if pagination.has_prev %}
            <a class="btn btn-outline-secondary btn-sm"
               href="{{ url_for('delivery.inventory_detail') }}?page={{ pagination.prev_num }}&material_id={{ form.material_id.data }}&description={{ form.description.data }}&storage_location={{ form.storage_location.data }}">
              ä¸Šä¸€é¡µ
            </a>
          {% else %}
            <button class="btn btn-outline-secondary btn-sm" disabled>ä¸Šä¸€é¡µ</button>
          {% endif %}

          {% if pagination.has_next %}
            <a class="btn btn-outline-secondary btn-sm"
               href="{{ url_for('delivery.inventory_detail') }}?page={{ pagination.next_num }}&material_id={{ form.material_id.data }}&description={{ form.description.data }}&storage_location={{ form.storage_location.data }}">
              ä¸‹ä¸€é¡µ
            </a>
          {% else %}
            <button class="btn btn-outline-secondary btn-sm" disabled>ä¸‹ä¸€é¡µ</button>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
