{% extends "delivery/base.html" %}

{% block content %}
<div class="form-title-container">
  <h1 class="form-title">ğŸ“¦ æ‹£è´§ä»»åŠ¡: {{ task.task_id }}</h1>
</div>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <a href="{{ url_for('delivery.picking_task_list') }}" class="btn btn-outline-primary">æ‹£è´§ä»»åŠ¡åˆ—è¡¨</a>
    {% if delivery %}
      <a href="{{ url_for('delivery.delivery_detail', delivery_id=delivery.delivery_note_id) }}" class="btn btn-outline-primary">æŸ¥çœ‹å‘è´§å•</a>

    {% if task.status == 'å·²å–æ¶ˆ' %}
            <a href="javascript:void(0);"
          class="btn btn-secondary disabled"
          aria-disabled="true">
            å–æ¶ˆæ‹£è´§
        </a>

    {% else %}
        <a href="{{ url_for('delivery.cancel_picking_task', task_id=task.task_id) }}"
          class="btn btn-primary">
            å–æ¶ˆæ‹£è´§
        </a>
    {% endif %}

    {% if task.status == 'å¾…æ‹£è´§' %}
        <a href="{{ url_for('delivery.confirm_picking_page', delivery_id=delivery.delivery_note_id, task_id=task.task_id) }}"
          class="btn btn-primary">
            æ‰§è¡Œæ‹£è´§
        </a>
    {% else %}
        <a href="javascript:void(0);"
          class="btn btn-secondary disabled"
          aria-disabled="true">
            æ‰§è¡Œæ‹£è´§
        </a>
    {% endif %}
        {% endif %}
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light"><h5 class="mb-0">ä»»åŠ¡ä¿¡æ¯</h5></div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p><strong>ä»»åŠ¡å·:</strong> {{ task.task_id }}</p>
          <p><strong>é”€å”®è®¢å•:</strong> {{ task.sales_order_id }}</p>
          <p><strong>ä»“åº“:</strong> {{ task.warehouse_code }}</p>
          <p><strong>æ‹£è´§å‘˜:</strong> {{ task.picker or '-' }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>çŠ¶æ€:</strong> {{ task.status }}</p>
          <p><strong>å¼€å§‹æ—¶é—´:</strong> {{ task.start_time.strftime('%Y-%m-%d %H:%M') if task.start_time else '-' }}</p>
          <p><strong>å®Œæˆæ—¶é—´:</strong> {{ task.complete_time.strftime('%Y-%m-%d %H:%M') if task.complete_time else '-' }}</p>
        </div>
      </div>
      <p><strong>å¤‡æ³¨:</strong> {{ task.remarks or '-' }}</p>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light"><h5 class="mb-0">æ‹£è´§æ˜ç»†</h5></div>
    <div class="card-body">
      <table class="table table-sm">
        <thead>
          <tr>
            <th>è¡Œå·</th>
            <th>ç‰©æ–™ç¼–å·</th>
            <th>æè¿°</th>
            <th>ä»“åº“ä½ç½®</th>
            <th>éœ€æ±‚æ•°é‡</th>
            <th>å·²æ‹£æ•°é‡</th>
          </tr>
        </thead>
        <tbody>
          {% for it in task.items %}
          <tr>
            <td>{{ it.item_no }}</td>
            <td>{{ it.material_id }}</td>
            <td>{{ it.material.description if it.material else '-' }}</td>
            <td>{{ it.storage_location or '-' }}</td>
            <td>{{ "%.2f"|format(it.required_quantity or 0) }}</td>
            <td>{{ "%.2f"|format(it.picked_quantity or 0) }}</td>
          </tr>
          {% else %}
          <tr><td colspan="6" class="text-center">æš‚æ— æ˜ç»†</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>


</div>
{% endblock %}
