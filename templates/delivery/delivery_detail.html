{% extends 'delivery/base.html' %}
{% block title %}发货详情{% endblock %}

{% block head_extra %}
<style>
  .card-detail {
    border-radius: 14px;
    background: linear-gradient(180deg, #ffffff, #f9fbff);
    box-shadow: 0 6px 20px rgba(34, 34, 34, 0.04);
    padding: 24px;
    margin-top: 1rem;
  }

  .card-detail h3 {
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .delivery-meta {
    font-size: 0.95rem;
    color: #556;
    margin-bottom: 0.5rem;
  }

  .delivery-meta .badge {
    font-size: 0.85rem;
    padding: 0.4em 0.6em;
  }

  .delivery-remarks {
    background-color: #f8fbff;
    border-left: 4px solid var(--brand-1);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-size: 0.95rem;
    color: #223;
    margin-bottom: 1rem;
  }

  .table th {
    background-color: #f1f6ff;
    font-weight: 600;
    color: #334;
    border-bottom: 1px solid rgba(34, 34, 34, 0.08);
  }

  .table td {
    vertical-align: middle;
  }

  .table tbody tr:nth-child(odd) {
    background-color: #fcfcfe;
  }

  .table tfoot td {
    background-color: #f7faff;
    font-weight: 600;
  }

  .btn-toolbar a {
    margin-right: 0.5rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="form-title-container">
    <h1 class="form-title">
      <i class="bi bi-truck"></i> 发货单 #{{ delivery.delivery_note_id }}
    </h1>
  </div>
  
<div class="card-detail">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="btn-toolbar">
      {% if delivery.status == '已创建' %}
        <a href="{{ url_for('delivery.edit_delivery', delivery_id=delivery.delivery_note_id) }}" class="btn btn-outline-secondary btn-sm"><i class="bi bi-pencil"></i> 编辑</a>
        <a href="{{ url_for('delivery.change_delivery_status', delivery_id=delivery.delivery_note_id) }}" class="btn btn-info btn-sm"><i class="bi bi-arrow-repeat"></i> 变更状态</a>
        <a href="{{ url_for('delivery.cancel_delivery', delivery_id=delivery.delivery_note_id) }}" class="btn btn-outline-danger btn-sm"><i class="bi bi-x-circle"></i> 取消</a>
      {% elif delivery.status == '已拣货' %}
        <a href="{{ url_for('delivery.post_delivery', delivery_id=delivery.delivery_note_id) }}" class="btn btn-success btn-sm"><i class="bi bi-check2-circle"></i> 过账</a>
        <a href="{{ url_for('delivery.change_delivery_status', delivery_id=delivery.delivery_note_id) }}" class="btn btn-info btn-sm"><i class="bi bi-arrow-repeat"></i> 变更状态</a>
        <a href="{{ url_for('delivery.cancel_delivery', delivery_id=delivery.delivery_note_id) }}" class="btn btn-outline-danger btn-sm"><i class="bi bi-x-circle"></i> 取消</a>
      {% endif %}
      <a href="{{ url_for('delivery.delivery_list') }}" class="btn btn-outline-primary btn-sm"><i class="bi bi-arrow-return-left"></i> 返回列表</a>
    </div>
  </div>

  <div class="delivery-meta">
    <span><i class="bi bi-file-earmark-text"></i> 销售订单：<strong>{{ delivery.sales_order_id }}</strong></span> |
    <span><i class="bi bi-geo-alt"></i> 仓库：{{ delivery.warehouse_code }}</span> |
    <span><i class="bi bi-calendar"></i> 发货日期：{{ delivery.delivery_date.strftime('%Y-%m-%d') }}</span> |
    <span>状态：
      {% if delivery.status == '已过账' %}
        <span class="badge bg-success">已过账</span>
      {% elif delivery.status == '已创建' %}
        <span class="badge bg-primary">已创建</span>
      {% elif delivery.status == '已拣货' %}
        <span class="badge bg-warning">已拣货</span>
      {% elif delivery.status == '已取消' %}
        <span class="badge bg-secondary">已取消</span>
      {% else %}
        <span class="badge bg-secondary">{{ delivery.status }}</span>
      {% endif %}
    </span>
  </div>

  <div class="delivery-remarks">
    <i class="bi bi-chat-dots"></i> {{ delivery.remarks or '无备注信息' }}
  </div>

  <div class="table-responsive">
    <table class="table table-sm table-bordered">
      <thead>
        <tr>
          <th style="width:80px">行号</th>
          <th style="min-width:140px">物料编号</th>
          <th style="width:120px" class="text-end">计划发货</th>
          <th style="width:120px" class="text-end">实际发货</th>
          <th style="width:90px">单位</th>
        </tr>
      </thead>
      <tbody>
        {% for l in delivery.items %}
        <tr>
          <td>{{ l.item_no }}</td>
          <td>{{ l.material_id }}</td>
          <td class="text-end">{{ "%.2f"|format(l.planned_delivery_quantity or 0) }}</td>
          <td class="text-end">{{ "%.2f"|format(l.actual_delivery_quantity or 0) }}</td>
          <td>{{ l.unit }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
