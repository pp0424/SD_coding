{% extends "delivery/base.html" %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='delivery/delivery_styles.css') }}">
<style>
      /* 表格所有单元格不换行 */
      .delivery-table th,
      .delivery-table td {
        white-space: nowrap;   /* 禁止自动换行 */
        vertical-align: middle; /* 让内容垂直居中，可选 */
      }

      .delivery-card {
        width: 100%;
      }
</style>
{% endblock %}


{% block content %}
<div class="form-title-container">
    <h1 class="form-title">📦 拣货管理</h1>
</div>

<div class="delivery-card animate-fade">
<!-- 查询表单 -->
  <form method="get" class="row g-3 query-form align-items-end">
      {{ form.csrf_token }}

      <div class="col-md-2">
        {{ form.delivery_id.label(class="form-label") }}
        {{ form.delivery_id(class="form-control", placeholder="发货单号") }}
      </div>

      <div class="col-md-2">
        {{ form.sales_order_id.label(class="form-label") }}
        {{ form.sales_order_id(class="form-control", placeholder="销售订单号") }}
      </div>

      <div class="col-md-2">
        {{ form.status.label(class="form-label") }}
        {{ form.status(class="form-select") }}
      </div>

      <div class="col-md-2">
        {{ form.start_date.label(class="form-label") }}
        {{ form.start_date(class="form-control", type="date") }}
      </div>

      <div class="col-md-2">
        {{ form.end_date.label(class="form-label") }}
        {{ form.end_date(class="form-control", type="date") }}
      </div>

      <div class="col-md-2">
        {{ form.submit(class="btn btn-search w-100") }}
      </div>
  </form>
</div>



<div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="thead-light">
            <tr>
              <th>任务编号</th>
              <th>销售订单</th>
              <th>仓库</th>
              <th>状态</th>
              <th>拣货员</th>
              <th>开始时间</th>
              <th>完成时间</th>
              <th>关联发货单</th>
            </tr>
          </thead>
          <tbody>
            {% for row in rows %}
            {% set task = row.task %}
            {% set delivery = row.delivery %}
            <tr>
              <td>
                <a href="{{ url_for('delivery.picking_task_detail', task_id=task.task_id) }}">
                  {{ task.task_id }}
                </a>
              </td>
              <td>{{ task.sales_order_id }}</td>
              <td>{{ task.warehouse_code }}</td>
              <td>
                <span class="badge
                  {% if task.status == '待拣货' %}bg-warning
                  {% elif task.status == '已完成' %}bg-success
                  {% else %}bg-danger{% endif %}">
                  {{ task.status }}
                </span>
              </td>
              <td>{{ task.picker or '-' }}</td>
              <td>{{ task.start_time.strftime('%Y-%m-%d %H:%M') if task.start_time else '-' }}</td>
              <td>{{ task.complete_time.strftime('%Y-%m-%d %H:%M') if task.complete_time else '-' }}</td>
              <td>
                {% if delivery %}
                  <a href="{{ url_for('delivery.picking_task_detail', task_id=task.task_id) }}">
                    {{ delivery.delivery_note_id }}
                  </a>
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="8" class="text-center">暂无拣货任务</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
