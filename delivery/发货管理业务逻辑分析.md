# 发货管理业务逻辑分析

## 1. 业务流程概述

根据搜索结果，发货管理（或出库管理）的核心业务流程通常包括以下几个主要环节：

1.  **订单接收与验证**：
    *   系统接收客户订单（销售订单），并进行有效性验证，如库存检查、客户信用检查等。
    *   订单状态：待处理/已创建。

2.  **拣货（Picking）**：
    *   根据订单生成拣货任务或拣货单。
    *   仓库人员按照拣货单指示，从仓库中拣选出对应物料。
    *   物料数量发生变化（库存减少）。
    *   拣货单状态：待拣货 -> 已拣货。
    *   发货单状态：已创建 -> 已拣货（或待发货）。

3.  **包装（Packing）**：
    *   对拣选出的物料进行包装，确保运输安全。
    *   可能生成包装清单。

4.  **发货单生成与确认**：
    *   生成正式的发货单（或出库单）。
    *   发货单信息包括物料、数量、收货地址、物流信息等。
    *   发货单状态：已拣货 -> 待发货。

5.  **出库与运输（Shipping）**：
    *   物料离开仓库，交由物流承运商。
    *   更新物流跟踪号。
    *   发货单状态：待发货 -> 已发货。

6.  **过账（Posting）**：
    *   财务或库存系统进行过账操作，正式扣减库存，确认销售收入。
    *   过账通常在物料实际出库后进行，或者在确认发货后进行。
    *   **关键业务逻辑**：只有“已拣货”或“已发货”状态的发货单才能进行过账操作。
    *   发货单状态：已拣货/已发货 -> 已过账。

7.  **客户签收与反馈**：
    *   客户收到货物并确认签收。
    *   订单状态：已发货 -> 已完成。

8.  **异常处理**：
    *   退货、破损、少发、多发等异常情况的处理流程。



## 2. 详细业务逻辑与状态流转

### 2.1 发货单（Delivery Order）状态流转

发货单是发货管理模块的核心单据，其状态流转反映了整个发货过程的进展。以下是发货单的主要状态及其流转逻辑：

*   **已创建 (Created)**：
    *   **触发条件**：系统根据销售订单生成发货单。
    *   **业务影响**：发货单进入待处理状态，物料尚未被分配或拣选。
    *   **可流转至**：待拣货。

*   **待拣货 (Pending Picking)**：
    *   **触发条件**：发货单已创建，等待仓库人员进行拣货操作。
    *   **业务影响**：系统可能生成拣货任务或拣货单。
    *   **可流转至**：已拣货。

*   **已拣货 (Picked)**：
    *   **触发条件**：仓库人员完成拣货操作，确认物料已从库存中拣选出。
    *   **业务影响**：
        *   **物料数量变化**：对应物料的“可用库存”减少，但“实际库存”可能仍保留在仓库内，等待包装或出库。或者，如果系统支持，物料状态可变为“已分配”或“待出库”。
        *   **拣货单状态**：关联的拣货单状态变为“已完成”。
    *   **可流转至**：待发货、已过账（特殊情况，如先过账再实际发货）。

*   **待发货 (Pending Shipment)**：
    *   **触发条件**：发货单已拣货，等待物料包装并实际出库。
    *   **业务影响**：物料已准备好发运。
    *   **可流转至**：已发货。

*   **已发货 (Shipped)**：
    *   **触发条件**：物料已实际离开仓库，交由物流承运商。
    *   **业务影响**：
        *   **物料数量变化**：对应物料的“实际库存”减少。
        *   **物流信息**：记录物流承运商和跟踪号。
    *   **可流转至**：已过账、已完成。

*   **已过账 (Posted)**：
    *   **触发条件**：
        *   **前置条件**：发货单状态为“已拣货”或“已发货”。
        *   **操作**：财务或库存系统执行过账操作。
    *   **业务影响**：
        *   **财务影响**：确认销售收入，生成应收账款。
        *   **库存影响**：物料库存正式扣减。
        *   **不可逆性**：过账操作通常是不可逆的，或需要冲销操作。
    *   **可流转至**：已完成。

*   **已完成 (Completed)**：
    *   **触发条件**：客户已签收货物，或发货单已过账且无后续异常。
    *   **业务影响**：发货流程结束。
    *   **不可流转**：通常为最终状态。

*   **已取消 (Cancelled)**：
    *   **触发条件**：在发货流程的早期阶段（如“已创建”、“待拣货”），因特殊原因（如客户取消订单）取消发货单。
    *   **业务影响**：
        *   **物料数量恢复**：如果物料已被分配或拣选，需恢复其可用库存。
        *   **订单状态**：关联的销售订单状态可能变为“已取消”。
    *   **不可流转**：通常为最终状态。

### 2.2 物料（Material）数量与状态变化

在发货管理过程中，物料的数量和状态会随着发货单的进展而发生变化，这对于库存的准确性至关重要。

*   **可用库存 (Available Stock)**：指当前可用于销售或分配的物料数量。
*   **实际库存 (Physical Stock)**：指仓库中实际存在的物料数量。
*   **待出库量 (Outbound Pending Quantity)**：指已被分配或拣选，但尚未实际出库的物料数量。

**变化逻辑**：

1.  **订单创建/发货单创建**：
    *   **影响**：如果系统支持预分配，此时可能减少“可用库存”，增加“待出库量”。

2.  **拣货操作**：
    *   **影响**：
        *   “可用库存”减少（如果之前未预分配，此时正式分配）。
        *   “待出库量”增加（或保持不变，如果之前已预分配）。
        *   物料在系统中的状态可能从“在库”变为“已拣选”或“待发运”。

3.  **发货（出库）操作**：
    *   **影响**：
        *   “实际库存”减少。
        *   “待出库量”减少。
        *   物料在系统中的状态从“已拣选”或“待发运”变为“已出库”。

4.  **过账操作**：
    *   **影响**：
        *   “实际库存”正式扣减（如果之前未扣减）。
        *   财务账面库存减少。

5.  **发货单取消**：
    *   **影响**：
        *   如果物料已被分配或拣选，则“可用库存”恢复。
        *   “待出库量”减少。

### 2.3 业务操作与状态流转的关联

| 业务操作       | 触发条件                               | 发货单状态变化         | 物料数量/状态变化                                  | 备注                                         |
| :------------- | :------------------------------------- | :--------------------- | :------------------------------------------------- | :------------------------------------------- |
| **创建发货单** | 销售订单审核通过                       | 无 -> 已创建           | 无                                                 |                                              |
| **生成拣货任务** | 发货单状态为“已创建”                   | 已创建 -> 待拣货       | 无                                                 | 系统自动或手动触发                           |
| **执行拣货**   | 仓库人员完成拣货                       | 待拣货 -> 已拣货       | 可用库存减少，待出库量增加，物料状态变为“已拣选” | 拣货后物料数量减少（可用库存），状态变为已拣货 |
| **执行包装**   | 发货单状态为“已拣货”                   | 已拣货 -> 待发货       | 无（或物料状态变为“已包装”）                      |                                              |
| **确认发货**   | 物料实际出库，交由物流                 | 待发货 -> 已发货       | 实际库存减少，待出库量减少，物料状态变为“已出库” |                                              |
| **执行过账**   | 发货单状态为“已拣货”或“已发货”       | 已拣货/已发货 -> 已过账 | 实际库存正式扣减，财务账面库存减少                 | 只有已拣货或已发货的发货单才能过账           |
| **客户签收**   | 客户确认收货                           | 已发货 -> 已完成       | 无                                                 |                                              |
| **取消发货单** | 在早期阶段（已创建/待拣货）取消订单 | 任意早期状态 -> 已取消 | 如有分配或拣选，可用库存恢复，待出库量减少         |                                              |


